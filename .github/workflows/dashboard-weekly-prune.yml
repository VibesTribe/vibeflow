name: Dashboard Weekly Prune

on:
  schedule:
    - cron: '0 6 * * 1'

jobs:
  prune:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Prune old snapshots
        run: |
          SNAP_DIR=".snapshots/dashboard"
          if [ -d "$SNAP_DIR" ]; then
            cd "$SNAP_DIR"
            ls -1t | tail -n +11 | xargs -r rm -rf
            cd ../..
            git config user.name "Vibeflow Auto"
            git config user.email "actions@github.com"
            git add .snapshots/dashboard
            git commit -m "Prune old dashboard snapshots" || echo "No old snapshots to remove"
            git push
          fi
