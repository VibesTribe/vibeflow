<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibePilot - Raindrop Authorization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .status-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .status-box.success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        
        .status-box.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        
        .code-display {
            background: #1a1a2e;
            color: #00ff88;
            font-family: 'Courier New', monospace;
            padding: 20px;
            border-radius: 8px;
            word-break: break-all;
            margin: 20px 0;
            font-size: 14px;
            position: relative;
        }
        
        .code-display label {
            color: #888;
            font-size: 12px;
            text-transform: uppercase;
            display: block;
            margin-bottom: 8px;
        }
        
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .copy-btn:hover {
            background: #5568d3;
        }
        
        .instructions {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .instructions h3 {
            color: #1976d2;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .instructions ol {
            margin-left: 20px;
            color: #333;
        }
        
        .instructions li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .instructions code {
            background: #fff;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 13px;
            border: 1px solid #ddd;
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            text-align: center;
            color: #666;
            padding: 40px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Raindrop Authorization</h1>
        <p class="subtitle">VibePilot Research Integration</p>
        
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Processing authorization...</p>
        </div>
        
        <div id="success-view" class="hidden">
            <div class="status-box success">
                <strong>‚úÖ Authorization Successful!</strong>
                <p style="margin-top: 10px;">Raindrop has authorized VibePilot to access your bookmarks.</p>
            </div>
            
            <div class="code-display">
                <label>Authorization Code</label>
                <span id="auth-code"></span>
                <button class="copy-btn" onclick="copyCode()">Copy</button>
            </div>
            
            <div class="instructions">
                <h3>Next Steps for VibePilot Agent</h3>
                <ol>
                    <li><strong>Copy the code above</strong> (click the Copy button)</li>
                    <li>Paste it to the VibePilot agent/LLM</li>
                    <li>The agent will exchange it for an access token</li>
                    <li>Token will be stored in Supabase vault for future use</li>
                </ol>
                <p style="margin-top: 15px; font-size: 14px; color: #666;">
                    <strong>Note:</strong> This code expires in a few minutes. If it expires, you'll need to authorize again.
                </p>
            </div>
        </div>
        
        <div id="error-view" class="hidden">
            <div class="status-box error">
                <strong>‚ùå Authorization Failed</strong>
                <p style="margin-top: 10px;" id="error-message">No authorization code received.</p>
            </div>
            
            <div class="instructions">
                <h3>Troubleshooting</h3>
                <ol>
                    <li>Make sure you clicked "Authorize" on the Raindrop page</li>
                    <li>Try the authorization flow again</li>
                    <li>Check that the VibePilot app is properly configured in Raindrop settings</li>
                </ol>
            </div>
        </div>
        
        <div id="no-code-view" class="hidden">
            <div class="status-box">
                <strong>‚ÑπÔ∏è Waiting for Authorization</strong>
                <p style="margin-top: 10px;">If you're seeing this page without authorizing, please:</p>
            </div>
            
            <div class="instructions">
                <h3>To Authorize VibePilot</h3>
                <ol>
                    <li>Visit the authorization URL provided by your VibePilot agent</li>
                    <li>Click "Authorize" on the Raindrop page</li>
                    <li>You'll be redirected back here with the code</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        // Parse URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        const error = urlParams.get('error');
        
        // Hide loading
        document.getElementById('loading').classList.add('hidden');
        
        if (error) {
            // Show error view
            document.getElementById('error-view').classList.remove('hidden');
            document.getElementById('error-message').textContent = `Error: ${error}`;
        } else if (code) {
            // Show success view with code
            document.getElementById('success-view').classList.remove('hidden');
            document.getElementById('auth-code').textContent = code;
        } else {
            // Show no-code view
            document.getElementById('no-code-view').classList.remove('hidden');
        }
        
        // Copy code function
        function copyCode() {
            const codeElement = document.getElementById('auth-code');
            const code = codeElement.textContent;
            
            navigator.clipboard.writeText(code).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.textContent = 'Copied!';
                setTimeout(() => {
                    btn.textContent = 'Copy';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                // Fallback: select text
                const range = document.createRange();
                range.selectNode(codeElement);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
            });
        }
        
        // Auto-select code on load for easy copying
        window.addEventListener('load', () => {
            if (code) {
                const codeElement = document.getElementById('auth-code');
                const selection = window.getSelection();
                const range = document.createRange();
                range.selectNodeContents(codeElement);
                selection.removeAllRanges();
                selection.addRange(range);
            }
        });
    </script>
</body>
</html>
